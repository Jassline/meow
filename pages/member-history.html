<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„æ¶ˆè²»ç´€éŒ„ | MEOW SELECT</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <a href="index.html" class="logo">MEOW SELECT</a>
        <div class="nav-links">
            <a href="../index.html" >é¦–é </a>
            <a href="about.html">å“ç‰Œæ•…äº‹</a> 
            <a href="shop.html">æ‰€æœ‰å•†å“</a>
            <a href="member.html">æœƒå“¡ä¸­å¿ƒ</a>
            <button id="cart-btn">ğŸ›’ è³¼ç‰©è»Š</button>
        </div>
    </nav>

    <div class="container" style="max-width: 800px; margin-top: 50px;">
        <h2 style="margin-bottom: 30px;">ğŸ“‹ æ‚¨çš„æ¶ˆè²»ç´€éŒ„</h2>
        <div id="user-order-history">
            </div>
    </div>

    <script>
        function renderUserOrders() {
            const container = document.getElementById('user-order-history');
            
            // 1. å…ˆæŠ“å‡ºç›®å‰ç™»å…¥çš„æœƒå“¡æ˜¯èª°
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            // å¦‚æœæ²’ç™»å…¥ï¼Œå°±å«ä»–æ»¾å»ç™»å…¥ï¼ˆé–‹ç©ç¬‘çš„ï¼Œæ˜¯å¼•å°ä»–å»ç™»å…¥ï¼‰
            if (!currentUser) {
                container.innerHTML = '<p style="text-align:center;">è«‹å…ˆç™»å…¥æœƒå“¡æ‰èƒ½æŸ¥çœ‹ç´€éŒ„å–”å–µï¼</p>';
                return;
            }

            // 2. æŠ“å‡ºæ‰€æœ‰çš„è¨‚å–®ç´€éŒ„
            let allHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];

            // 3. âœ¨ é—œéµéæ¿¾ï¼šåªç•™ä¸‹ email è·Ÿæˆ‘ä¸€æ¨£çš„è¨‚å–®
            // (å‡è¨­ä½ åœ¨çµå¸³å­˜å…¥è¨‚å–®æ™‚ï¼Œæœ‰å­˜å…¥ customer.email)
            let myHistory = allHistory.filter(order => order.customer.email === currentUser.email);
            
            if (myHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding:100px 0;">
                        <p style="font-size: 50px;">ğŸ˜¿</p>
                        <p>æ‚¨ï¼ˆ${currentUser.name}ï¼‰é‚„æ²’æœ‰åœ¨ MEOW SELECT æ¶ˆè²»éå–”ï¼</p>
                        <a href="shop.html" style="color:#ff9f43;">å»å•†åŸé€›é€›</a>
                    </div>
                `;
                return;
            }

            // member-history.html çš„æ¸²æŸ“é‚è¼¯ä¿®å¾©
            container.innerHTML = '';
            myHistory.reverse().forEach(order => {
                // é€™è£¡æ˜¯åœ¨æ•´ç†æ¸…å–®ç´°é …
                let itemsList = order.items.map(i => `<li>${i.name} (x${i.qty}) - $${i.price * i.qty}</li>`).join('');
                
                container.innerHTML += `
                    <div style="background:white; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid #ff9f43;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom: 1px dashed #eee; padding-bottom: 10px;">
                            <span style="font-weight:bold; color:#333;">ğŸ“… è¨‚å–®æ—¥æœŸï¼š${order.orderDate}</span>
                            <span style="color:#888; font-size:12px;"># ${order.orderId}</span>
                        </div>

                        <div style="font-size: 14px; color: #555; background: #fff9f4; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 3px 0;">ğŸ‘¤ <strong>æ”¶ä»¶äººï¼š</strong>${order.customer.name}</p>
                            <p style="margin: 3px 0;">ğŸ“ <strong>é€£çµ¡é›»è©±ï¼š</strong>${order.customer.phone}</p>
                            <p style="margin: 3px 0;">ğŸ“ <strong>é…é€åœ°å€ï¼š</strong>${order.customer.address}</p>
                            <p style="margin: 3px 0;">ğŸ’³ <strong>ä»˜æ¬¾æ–¹å¼ï¼š</strong>${order.paymentMethod} (${order.paymentDetail || 'ç„¡'})</p>
                            <p style="margin: 3px 0;">ğŸ§¾ <strong>ç™¼ç¥¨è³‡è¨Šï¼š</strong>${order.invoice}</p>
                        </div>

                        <ul style="list-style:none; padding:0 10px; margin-bottom:15px; font-size:14px; color:#666;">
                            <p style="font-weight:bold; color:#333; margin-bottom:5px;">ğŸ›’ è³¼è²·æ¸…å–®ï¼š</p>
                            ${itemsList}
                        </ul>

                        <div style="text-align:right; font-weight:bold; font-size:1.1rem; color:#ee5253; border-top: 1px solid #eee; margin-top:10px; padding-top:10px;">
                            ç¸½é¡ï¼š$${order.totalAmount}
                        </div>
                    </div>
                `;
            });
        }
        window.onload = renderUserOrders;
    </script>
        <aside class="cart-sidebar" id="cartSidebar" role="dialog" aria-modal="true" aria-labelledby="cartTitle" tabindex="-1" hidden>
        <div class="cart-header">
            <h3 id="cartTitle">è³¼ç‰©è¢‹</h3>
            <button id="close-btn" type="button" class="icon-btn" aria-label="é—œé–‰è³¼ç‰©è»Š">&times;</button>
        </div>

        <div id="cart-items-list" class="cart-items" aria-live="polite"></div>

        <div class="cart-footer">
            <div class="cart-total-row">
                <span>ç¸½è¨ˆ</span>
                <span id="cart-total-display">$0</span>
            </div>
            <button class="checkout-btn" type="button" onclick="location.href='checkout.html'">
                å‰å¾€çµå¸³
            </button>
        </div>
    </aside>
    <script src="../js/chat.js"></script>
</body>
</html>